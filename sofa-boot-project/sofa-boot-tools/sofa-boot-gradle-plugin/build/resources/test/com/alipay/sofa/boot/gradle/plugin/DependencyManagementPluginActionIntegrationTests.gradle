plugins {
    id 'java'
    id 'com.alipay.sofa.boot' version '{version}'
}

def property(String name, Object defaultValue) {
    project.hasProperty(name) ? project.getProperty(name) : defaultValue
}

if (project.hasProperty('applyDependencyManagementPlugin')) {
    apply plugin: 'io.spring.dependency-management'
    dependencyManagement {
        resolutionStrategy {
            eachDependency {
                if (it.requested.group == 'com.alipay.sofa') {
                    it.useVersion project.bootVersion
                }
            }
        }
    }
}

repositories {
    maven { url 'file:repository' }
}

task hasDependencyManagement {
    doLast {
        if (!dependencyManagement.managedVersions) {
            throw new GradleException('No managed versions have been configured')
        } else {
            if (!dependencyManagement.managedVersions["com.alipay.sofa:runtime-sofa-boot-starter"].equals(project.bootVersion)) {
                throw new GradleException("runtime-sofa-boot-starter's version is not " + project.bootVersion)
            }
        }
    }
}
